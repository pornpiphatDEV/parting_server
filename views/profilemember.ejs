<!DOCTYPE html>
<html lang="en">

<head>
	<title>ผู้ใช้งานทั้งหมด</title><!-- Meta -->
	<meta charset="utf-8">
	<meta content="IE=edge" http-equiv="X-UA-Compatible">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<meta content="Portal - Bootstrap 5 Admin Dashboard Template For Developers" name="description">
	<meta content="Xiaoying Riley at 3rd Wave Media" name="author">


	<script defer src="/assets/plugins/fontawesome/js/all.min.js">
	</script><!-- App CSS -->
	<link href="/assets/css/portal.css" id="theme-style" rel="stylesheet">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>


	<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<script src="https://cdn.datatables.net/1.11.0/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.11.0/js/dataTables.bootstrap5.min.js"></script>


	<script src="https://cdn.datatables.net/buttons/2.0.0/js/dataTables.buttons.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.0.0/js/buttons.html5.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.0.0/js/buttons.print.min.js"></script>

	<link rel="stylesheet" href="https://cdn.datatables.net/1.11.1/css/jquery.dataTables.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.0.0/css/buttons.dataTables.min.css">

</head>

<body class="app">
	<header class="app-header fixed-top bg-success">
		<div class="app-header-inner">
			<div class="container-fluid py-2">
				<div class="app-header-content">
					<div class="row justify-content-between align-items-center">
						<div class="col-auto">
							<a class="sidepanel-toggler d-inline-block d-xl-none" href="#" id="sidepanel-toggler"><svg
									height="30" role="img" viewbox="0 0 30 30" width="30"
									xmlns="http://www.w3.org/2000/svg">
									<title>Menu</title>
									<path d="M4 7h22M4 15h22M4 23h22" stroke="currentColor" stroke-linecap="round"
										stroke-miterlimit="10" stroke-width="2"></path>
								</svg>
							</a>
						</div>
						<!--//col-->

						<div class="app-utilities col-auto">

							<!--//app-utility-item-->
							<div class="app-utility-item app-user-dropdown dropdown">
								<a aria-expanded="false" class="dropdown-toggle" data-bs-toggle="dropdown" href="#"
									id="user-dropdown-toggle" role="button"><img alt="user profile"
										class="rounded-circle" src="/assets/images/atmin.jpg"></a>
								<ul aria-labelledby="user-dropdown-toggle" class="dropdown-menu">
									<li>
										<a class="dropdown-item" href="/logout">ออกจากระบบ</a>
									</li>
								</ul>
							</div>
							<!--//app-user-dropdown-->
						</div>
						<!--//app-utilities-->
					</div>
					<!--//row-->
				</div>
				<!--//app-header-content-->
			</div>
			<!--//container-fluid-->
		</div>
		<!--//app-header-inner-->
		<div class="app-sidepanel" id="app-sidepanel">
			<div class="sidepanel-drop" id="sidepanel-drop"></div>
			<div class="sidepanel-inner d-flex flex-column">
				<div class="app-branding">
					<img alt="logo" class=" me-2" src="/assets/images/logo2.png" width="50"><span
						class="logo-text">Parking system</span>
				</div>
				<!--//app-branding-->
				<nav class="app-nav app-nav-main flex-grow-1" id="app-nav-main">
					<ul class="app-menu list-unstyled accordion" id="menu-accordion">
						<li class="nav-item">
							<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
							<a class="nav-link active" href="/dashboard"><span class="nav-icon"><svg
										class="bi bi-house-door" height="1em" viewbox="0 0 16 16" width="1em"
										xmlns="http://www.w3.org/2000/svg">
										<path
											d="M7.646 1.146a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 .146.354v7a.5.5 0 0 1-.5.5H9.5a.5.5 0 0 1-.5-.5v-4H7v4a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .146-.354l6-6zM2.5 7.707V14H6v-4a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4h3.5V7.707L8 2.207l-5.5 5.5z"
											fill-rule="evenodd"></path>
										<path d="M13 2.5V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"
											fill-rule="evenodd"></path>
									</svg></span> <span class="nav-link-text">หน้าหลัก</span></a>
							<!--//nav-link-->
						</li>
						<!--//nav-item-->



						<li class="nav-item">
							<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
							<a class="nav-link" href="/income"><span class="nav-icon"><svg class="bi bi-card-list"
										height="1em" viewbox="0 0 16 16" width="1em"
										xmlns="http://www.w3.org/2000/svg"></svg></span> <span
									class="nav-link-text">รายได้</span></a>
							<!--//nav-link-->
						</li>
						<!--//nav-item-->
						<li class="nav-item">
							<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
							<a class="nav-link" href="/member"><span class="nav-icon"><svg class="bi bi-card-list"
										height="1em" viewbox="0 0 16 16" width="1em"
										xmlns="http://www.w3.org/2000/svg"></svg></span> <span
									class="nav-link-text">สมาชิก</span></a>
							<!--//nav-link-->
						</li>
						<!--//nav-item-->
						<li class="nav-item">
							<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
							<a class="nav-link" href="/parkingreport"><span class="nav-icon"><svg
										class="bi bi-card-list" height="1em" viewbox="0 0 16 16" width="1em"
										xmlns="http://www.w3.org/2000/svg"></svg></span> <span
									class="nav-link-text">รายงานการเข้าลานจอด</span></a>
							<!--//nav-link-->
						</li>
						<!--//nav-item-->
					</ul>
					<!--//app-menu-->
				</nav>
				<!--//app-nav-->
			</div>
			<!--//sidepanel-inner-->
		</div>
		<!--//app-sidepanel-->
	</header>
	<!--//app-header-->
	<!-- MAIN -->
	<div class="app-wrapper">
		<div class="app-content pt-3 p-md-3 p-lg-4">
			<div class="container-xl">



				<div class="container">
					<div class="main-body">


						<div class="row gutters-sm">
							<div class="col-md-4 mb-3">
								<div class="card">
									<div class="card-body">
										<div class="d-flex flex-column align-items-center text-center">
											<img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Admin"
												class="rounded-circle" width="150">

										</div>
									</div>
								</div>
							</div>

							<div class="col-md-8">
								<div class="card mb-3">
									<div class="card-title">


										<div class="d-flex flex-row-reverse bd-highlight">

											<div class="p-2 bd-highlight">

												<div class="app-utility-item app-user-dropdown dropdown">
													<a aria-expanded="false" class="dropdown-toggle"
														data-bs-toggle="dropdown" href="#" id="user-dropdown-toggle"
														role="button"></a>
													<ul aria-labelledby="user-dropdown-toggle" class="dropdown-menu">
														<li>
															<!-- <a class="dropdown-item editmember"
                                                                href="#">แก้ไขข้อมูลผู้ใช้งาน</a> -->
															<samp class="dropdown-item"
																id="eitdmember">แก้ไขข้อมูลผู้ใช้งาน</samp>
														</li>
														<li>

															<samp class="dropdown-item"
																onclick="deletemember('<%= member[0].id %>')">ลบข้อมูลผู้ใช้งาน</samp>
														</li>
													</ul>
												</div>

											</div>
										</div>
									</div>
									<div class="card-body">

										<div id="username">
											<div class="row">
												<div class="col-sm-3">
													<h6 class="mb-0">ชื่อ-นามสกุล</h6>
												</div>
												<div class="col-sm-9 text-secondary">
													<%= member[0].prefix %>
														<%= member[0].firstname %>
															<%= member[0].lastname %>
												</div>
											</div>
										</div>


										<div id="inusername">
											<div class="row mb-2">
												<div class="col-sm-3">
													<h6 class="mb-0">ชื่อ</h6>
												</div>
												<div class="col-sm-9 text-secondary">

													<input type="text" name="firstname" id="firstname"
														value="<%= member[0].firstname %> ">
												</div>
											</div>
											<div class="row mb-2">
												<div class="col-sm-3">
													<h6 class="mb-0">นามสกุล</h6>
												</div>
												<div class="col-sm-9 text-secondary">
													<input type="text" name="lasname" id="lastname"
														value="<%= member[0].lastname %> ">
												</div>
											</div>

											<div class="row mb-2">
												<div class="col-sm-3">
													<h6 class="mb-0">หมายเลขทะเบียนรถ</h6>
												</div>
												<div class="col-sm-9 text-secondary">
													<input type="text" id="car_carregistration"
														value="<%= member[0].car_carregistration %>"
														class="form-control" />
												</div>
											</div>

											<div class="mt-3 " id="btnsubmit">
												<button class="btn btn-outline-primary"
													onclick="myFunction('<%= member[0].id %>' ,'<%= member[0].userscarid %>' )">บันทึก</button>
												<button class="btn btn-outline-danger" id="canceledit">ยกเลิก</button>
											</div>
										</div>








										<br>

										<div id="email">
											<div class="row">
												<div class="col-sm-3">
													<h6 class="mb-0">Email</h6>
												</div>
												<div class="col-sm-9 text-secondary">
													<%= member[0].email %>
												</div>
											</div>
										</div>




										<br>

										<div id="carregistration">
											<div class="row">
												<div class="col-sm-3">
													<h6 class="mb-0">หมายเลขทะเบียนรถ</h6>
												</div>
												<div class="col-sm-9 text-secondary">
													<%= member[0].car_carregistration %>
												</div>
											</div>
										</div>


										<div id="inputemail">
											<div class="row">
												<div class="col-sm-3">
													<h6 class="mb-0">Email</h6>
												</div>
												<div class="col-sm-9 text-secondary">

													<input type="text" value="fip@jukmuh.al" class="form-control" />
												</div>
											</div>
										</div>


										<br>

									</div>
								</div>
							</div>
						</div>

						<div class="tab-content" id="orders-table-tab-content">
							<div class="tab-pane fade show active" id="orders-all" role="tabpanel"
								aria-labelledby="orders-all-tab">
								<div class="app-card app-card-orders-table shadow-sm mb-5">
									<div class="app-card-body">
										<div class="table-responsive">
											<div class="container mt-2">
												<table id="example" class="display" style="width:100%">
													<thead>
														<tr>
															<th class="cell">วัน/เดือน/ปี </th>
															<th class="cell">ชื่อ-นามสกุล </th>
															<th class="cell">หมายเลขทะเบียนรถ </th>

															<th class="cell">สถานะการจอง </th>
															<th class="cell">ชำระค่าจอง
															</th>
															<th class="cell">ชำระค่าจอด
															</th>
														</tr>
													</thead>
													<tbody>

														<% var j=0 ;%>

															<% for(var i=0; i<bookingservice.length; i++) {%>





																<% if (bookingservice[i].booking_status !=='สำเร็จ' ) {
																	%>
																	<tr>
																		<td class="cell">
																			<%= bookingservice[i].bookingtimestamp.toLocaleString()
																				%>
																		</td>
																		<td class="cell">
																			<%= bookingservice[i].prefix %>
																				<%= bookingservice[i].firstname %>
																					<%= bookingservice[i].lastname %>
																		</td>

																		<td class="cell">
																			<%= bookingservice[i].car_carregistration %>
																		</td>


																		<% if
																			(bookingservice[i].booking_status==='ยกเลิก'
																			||
																			bookingservice[i].booking_status==='หมดอายุการใช้งาน'
																			) { %>
																			<td class="cell"><span
																					class="badge bg-danger">
																					<%= bookingservice[i].booking_status
																						%>
																				</span>
																			</td>
																			<%} else { %>
																				<td class="cell"><span
																						class="badge bg-warning">
																						<%= bookingservice[i].booking_status
																							%>
																					</span>
																				</td>
																				<% } %>


																					<td class="cell">
																						20
																					</td>
																					<td class="cell">
																						-
																					</td>
																	</tr>

																	<%} else { %>




																		<tr>
																			<td class="cell">
																				<%= income[j].bookingtimestamp.toLocaleString()
																					%>
																			</td>
																			<td class="cell">
																				<%= income[j].prefix %>
																					<%= income[j].firstname %>
																						<%= income[j].lastname %>
																			</td>

																			<td class="cell">
																				<%= income[j].car_carregistration %>
																			</td>
																			<td class="cell"><span
																					class="badge bg-success">
																					<%= income[j].booking_status %>
																				</span>
																			</td>
																			<td class="cell">
																				20
																			</td>
																			<td class="cell">
																				<%= income[j].servicecharge %>
																			</td>
																		</tr>




																		<% j++ ;%>
																			<% } %>


																				<% } %>

													</tbody>


												</table>
											</div>

										</div>
									</div>
								</div>
							</div>
						</div>





					</div>
				</div>

			</div>
			<!--//app-content-->
			<footer class="app-footer">
				<div class="container text-center py-3">
					<!--/* This template is free as long as you keep the footer attribution link. If you'd like to use the template without the attribution link, you can buy the commercial license via our website: themes.3rdwavemedia.com Thank you for your support. :) */-->
					<small class="copyright">Designed with <i class="fas fa-heart" style="color: #fb866a"></i> by <a
							class="app-link" href="http://themes.3rdwavemedia.com" target="_blank">Xiaoying Riley</a>
						for developers</small>
				</div>
			</footer>
			<!--//app-footer-->
		</div>
		<!--//app-wrapper-->
		<!--END MAIN -->
		<!-- Javascript -->

	</div>
	<script src="/assets/plugins/popper.min.js">
	</script>
	<script src="/assets/plugins/bootstrap/js/bootstrap.min.js">
	</script> <!-- Charts JS -->

	<script src="/assets/plugins/chart.js/chart.min.js">
	</script>
	<script src="/assets/js/index-charts.js">
	</script> <!-- Page Specific JS -->

	<script src="/assets/js/app.js">
	</script>
</body>

</html>





<script type="text/javascript">

	$(document).ready(function () {
		$('#example').DataTable({
			dom: 'Bfrtip',
			buttons: [
				'excel', 'pdf', 'print',
				{
					extend: 'csv',
					charset: 'UTF-8',
					fieldSeparator: ';',
					bom: true,
					filename: 'CsvTest',
					title: 'CsvTest'
				}

			]
		});
	});


	$("#btnsubmit").hide();
	$('#inusername').hide();
	$('#inputemail').hide();
	$('#inputcarregistration').hide();





	$("#eitdmember").click(() => {
		$("#btnsubmit").show();
		$('#inusername').show();
		// $('#inputemail').show();
		$('#inputcarregistration').show();
		$('#inputcardNumber').show();
		$('#username').hide();
		$('#email').hide();
		$('#carregistration').hide();

	});



	$("#canceledit").click(() => {
		$("#btnsubmit").hide();
		$('#inusername').hide();
		$('#inputemail').hide();
		$('#inputcarregistration').hide();
		$('#inputcardNumber').hide();
		$('#username').show();
		$('#email').show();
		$('#carregistration').show();
		$('#cardNumber').show();
	});






	function myFunction(id, userscarid) {
		console.log(id);
		console.log(userscarid);
		var firstname = document.getElementById("firstname").value;
		var lastname = document.getElementById("lastname").value;
		var car_carregistration = document.getElementById("car_carregistration").value;


		var rememberdata = {
			"uid": id,
			"userscarid": userscarid,
			"firstname": firstname,
			"lastname": lastname,
			"car_carregistration": car_carregistration
		};

		$.ajax({
			type: "POST",
			url: "http://localhost:3000/remember",
			// The key needs to match your method's input parameter (case-sensitive).
			data: JSON.stringify(rememberdata),
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				console.log(data);
			},
			error: function (errMsg) {
				console.log(errMsg.status);


				if (errMsg.status == 200) {
					location.reload();
				}
				else {
					alert("ผิดพลาดลองใหม่อีกครั้ง");
				}
			}
		});

	}





	function deletemember(id) {
		console.log(id);
		if (confirm("คุรต้องการลบผู้ใช้งานออกหรือไม่")) {
			location.href = `http://localhost:3000/deletemember/${id}`;
		}
	}






</script>